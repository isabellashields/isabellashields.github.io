var jsPsychCanvasKeyboardResponse=function(s){"use strict";const e={name:"canvas-keyboard-response",parameters:{stimulus:{type:s.ParameterType.FUNCTION,pretty_name:"Stimulus",default:void 0},choices:{type:s.ParameterType.KEYS,pretty_name:"Choices",default:"ALL_KEYS"},prompt:{type:s.ParameterType.HTML_STRING,pretty_name:"Prompt",default:null},stimulus_duration:{type:s.ParameterType.INT,pretty_name:"Stimulus duration",default:null},trial_duration:{type:s.ParameterType.INT,pretty_name:"Trial duration",default:null},response_ends_trial:{type:s.ParameterType.BOOL,pretty_name:"Response ends trial",default:!0},canvas_size:{type:s.ParameterType.INT,array:!0,pretty_name:"Canvas size",default:[500,500]}}};class t{constructor(s){this.jsPsych=s}trial(s,e){var t='<div id="jspsych-canvas-keyboard-response-stimulus"><canvas id="jspsych-canvas-stimulus" height="'+e.canvas_size[0]+'" width="'+e.canvas_size[1]+'"></canvas></div>';null!==e.prompt&&(t+=e.prompt),s.innerHTML=t;let a=document.getElementById("jspsych-canvas-stimulus");e.stimulus(a);var i={rt:null,key:null};const n=()=>{this.jsPsych.pluginAPI.clearAllTimeouts(),void 0!==l&&this.jsPsych.pluginAPI.cancelKeyboardResponse(l);var e={rt:i.rt,response:i.key};s.innerHTML="",this.jsPsych.finishTrial(e)};var r=t=>{s.querySelector("#jspsych-canvas-keyboard-response-stimulus").className+=" responded",null==i.key&&(i=t),e.response_ends_trial&&n()};if("NO_KEYS"!=e.choices)var l=this.jsPsych.pluginAPI.getKeyboardResponse({callback_function:r,valid_responses:e.choices,rt_method:"performance",persist:!1,allow_held_key:!1});null!==e.stimulus_duration&&this.jsPsych.pluginAPI.setTimeout(()=>{s.querySelector("#jspsych-canvas-keyboard-response-stimulus").style.visibility="hidden"},e.stimulus_duration),null!==e.trial_duration&&this.jsPsych.pluginAPI.setTimeout(()=>{n()},e.trial_duration)}simulate(s,e,t,a){"data-only"==e&&(a(),this.simulate_data_only(s,t)),"visual"==e&&this.simulate_visual(s,t,a)}simulate_data_only(s,e){const t=this.create_simulation_data(s,e);this.jsPsych.finishTrial(t)}simulate_visual(s,e,t){const a=this.create_simulation_data(s,e),i=this.jsPsych.getDisplayElement();this.trial(i,s),t(),null!==a.rt&&this.jsPsych.pluginAPI.pressKey(a.response,a.rt)}create_simulation_data(s,e){const t={rt:this.jsPsych.randomization.sampleExGaussian(500,50,1/150,!0),response:this.jsPsych.pluginAPI.getValidKey(s.choices)},a=this.jsPsych.pluginAPI.mergeSimulationData(t,e);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(s,a),a}}return t.info=e,t}(jsPsychModule);