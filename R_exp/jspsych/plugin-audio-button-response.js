var jsPsychAudioButtonResponse=function(t){"use strict";const e={name:"audio-button-response",parameters:{stimulus:{type:t.ParameterType.AUDIO,pretty_name:"Stimulus",default:void 0},choices:{type:t.ParameterType.STRING,pretty_name:"Choices",default:void 0,array:!0},button_html:{type:t.ParameterType.HTML_STRING,pretty_name:"Button HTML",default:'<button class="jspsych-btn">%choice%</button>',array:!0},prompt:{type:t.ParameterType.HTML_STRING,pretty_name:"Prompt",default:null},trial_duration:{type:t.ParameterType.INT,pretty_name:"Trial duration",default:null},margin_vertical:{type:t.ParameterType.STRING,pretty_name:"Margin vertical",default:"0px"},margin_horizontal:{type:t.ParameterType.STRING,pretty_name:"Margin horizontal",default:"8px"},response_ends_trial:{type:t.ParameterType.BOOL,pretty_name:"Response ends trial",default:!0},trial_ends_after_audio:{type:t.ParameterType.BOOL,pretty_name:"Trial ends after audio",default:!1},response_allowed_while_playing:{type:t.ParameterType.BOOL,pretty_name:"Response allowed while playing",default:!0},enable_button_after:{type:t.ParameterType.INT,pretty_name:"Enable button after",default:0}}};class a{constructor(t){this.jsPsych=t}trial(t,e,a){function n(t){var a=performance.now(),n=Math.round(a-l);null!==d&&(a=d.currentTime,n=Math.round(1e3*(a-l))),c.button=parseInt(t),c.rt=n,s(),e.response_ends_trial&&p()}function i(t){n(t.currentTarget.getAttribute("data-choice"))}function s(){for(var t=document.querySelectorAll(".jspsych-audio-button-response-button"),e=0;e<t.length;e++){var a=t[e].querySelector("button");a&&(a.disabled=!0),t[e].removeEventListener("click",i)}}function r(){for(var t=document.querySelectorAll(".jspsych-audio-button-response-button"),e=0;e<t.length;e++){var a=t[e].querySelector("button");a&&(a.disabled=!1),t[e].addEventListener("click",i)}}function o(){e.enable_button_after>0?y(e.enable_button_after):r()}let u;var l,d=this.jsPsych.pluginAPI.audioContext(),c={rt:null,button:null};this.jsPsych.pluginAPI.getAudioBuffer(e.stimulus).then(t=>{null!==d?(this.audio=d.createBufferSource(),this.audio.buffer=t,this.audio.connect(d.destination)):(this.audio=t,this.audio.currentTime=0),h()}).catch(()=>{});const h=()=>{e.trial_ends_after_audio&&this.audio.addEventListener("ended",p),e.response_allowed_while_playing||e.trial_ends_after_audio||this.audio.addEventListener("ended",o);var n=[];if(Array.isArray(e.button_html))e.button_html.length==e.choices.length&&(n=e.button_html);else for(var i=0;i<e.choices.length;i++)n.push(e.button_html);var r='<div id="jspsych-audio-button-response-btngroup">';for(i=0;i<e.choices.length;i++){var u=n[i].replace(/%choice%/g,e.choices[i]);r+='<div class="jspsych-audio-button-response-button" style="cursor: pointer; display: inline-block; margin:'+e.margin_vertical+" "+e.margin_horizontal+'" id="jspsych-audio-button-response-button-'+i+'" data-choice="'+i+'">'+u+"</div>"}r+="</div>",null!==e.prompt&&(r+=e.prompt),t.innerHTML=r,e.response_allowed_while_playing?(s(),o()):s(),l=performance.now(),null!==d?(l=d.currentTime,this.audio.start(l)):this.audio.play(),null!==e.trial_duration&&this.jsPsych.pluginAPI.setTimeout(()=>{p()},e.trial_duration),a()},p=()=>{this.jsPsych.pluginAPI.clearAllTimeouts(),null!==d?this.audio.stop():this.audio.pause(),this.audio.removeEventListener("ended",p),this.audio.removeEventListener("ended",o);var a={rt:c.rt,stimulus:e.stimulus,response:c.button};t.innerHTML="",this.jsPsych.finishTrial(a),u()},y=t=>{this.jsPsych.pluginAPI.setTimeout(r,t)};return new Promise(t=>{u=t})}simulate(t,e,a,n){"data-only"==e&&(n(),this.simulate_data_only(t,a)),"visual"==e&&this.simulate_visual(t,a,n)}create_simulation_data(t,e){const a={stimulus:t.stimulus,rt:this.jsPsych.randomization.sampleExGaussian(500,50,1/150,!0)+t.enable_button_after,response:this.jsPsych.randomization.randomInt(0,t.choices.length-1)},n=this.jsPsych.pluginAPI.mergeSimulationData(a,e);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(t,n),n}simulate_data_only(t,e){const a=this.create_simulation_data(t,e);this.jsPsych.finishTrial(a)}simulate_visual(t,e,a){const n=this.create_simulation_data(t,e),i=this.jsPsych.getDisplayElement(),s=()=>{null!==n.rt&&this.jsPsych.pluginAPI.clickTarget(i.querySelector(`div[data-choice="${n.response}"] button`),n.rt)};this.trial(i,t,()=>{a(),t.response_allowed_while_playing?s():this.audio.addEventListener("ended",s)})}}return a.info=e,a}(jsPsychModule);