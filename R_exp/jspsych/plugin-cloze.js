var jsPsychCloze=function(t){"use strict";const e={name:"cloze",parameters:{text:{type:t.ParameterType.HTML_STRING,pretty_name:"Cloze text",default:void 0},button_text:{type:t.ParameterType.STRING,pretty_name:"Button text",default:"OK"},check_answers:{type:t.ParameterType.BOOL,pretty_name:"Check answers",default:!1},allow_blanks:{type:t.ParameterType.BOOL,pretty_name:"Allow blanks",default:!0},mistake_fn:{type:t.ParameterType.FUNCTION,pretty_name:"Mistake function",default:()=>{}}}};class s{constructor(t){this.jsPsych=t}trial(t,e){var s='<div class="cloze">',a=e.text.split("%");const n=this.getSolutions(e.text);let i=0;for(var l=0;l<a.length;l++)l%2==0?s+=a[l]:(s+=`<input type="text" id="input${i}" value="">`,i++);s+="</div>",t.innerHTML=s;const o=()=>{for(var s=[],a=!0,i=!0,l=0;l<n.length;l++){var o=document.getElementById("input"+l);s.push(o.value.trim()),e.check_answers&&(s[l]!==n[l]?(o.style.color="red",a=!1):o.style.color="black"),e.allow_blanks||""===s[l]&&(i=!1)}if(e.check_answers&&!a||!e.allow_blanks&&!i)e.mistake_fn();else{var r={response:s};t.innerHTML="",this.jsPsych.finishTrial(r)}};t.innerHTML+='<br><button class="jspsych-html-button-response-button" type="button" id="finish_cloze_button">'+e.button_text+"</button>",t.querySelector("#finish_cloze_button").addEventListener("click",o)}getSolutions(t){const e=[],s=t.split("%");for(let t=0;t<s.length;t++)t%2==1&&e.push(s[t].trim());return e}simulate(t,e,s,a){"data-only"==e&&(a(),this.simulate_data_only(t,s)),"visual"==e&&this.simulate_visual(t,s,a)}create_simulation_data(t,e){const s=this.getSolutions(t.text),a=[];for(const t of s)""==t?a.push(this.jsPsych.randomization.randomWords({exactly:1})):a.push(t);const n={response:a};return this.jsPsych.pluginAPI.mergeSimulationData(n,e)}simulate_data_only(t,e){const s=this.create_simulation_data(t,e);this.jsPsych.finishTrial(s)}simulate_visual(t,e,s){const a=this.create_simulation_data(t,e),n=this.jsPsych.getDisplayElement();this.trial(n,t),s();const i=n.querySelectorAll('input[type="text"]');let l=this.jsPsych.randomization.sampleExGaussian(750,200,.01,!0);for(let t=0;t<a.response.length;t++)this.jsPsych.pluginAPI.fillTextInput(i[t],a.response[t],l),l+=this.jsPsych.randomization.sampleExGaussian(750,200,.01,!0);this.jsPsych.pluginAPI.clickTarget(n.querySelector("#finish_cloze_button"),l)}}return s.info=e,s}(jsPsychModule);