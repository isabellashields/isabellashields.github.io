var jsPsychSerialReactionTimeMouse=function(t){"use strict";const e={name:"serial-reaction-time-mouse",parameters:{grid:{type:t.ParameterType.BOOL,pretty_name:"Grid",array:!0,default:[[1,1,1,1]]},target:{type:t.ParameterType.INT,pretty_name:"Target",array:!0,default:void 0},grid_square_size:{type:t.ParameterType.INT,pretty_name:"Grid square size",default:100},target_color:{type:t.ParameterType.STRING,pretty_name:"Target color",default:"#999"},response_ends_trial:{type:t.ParameterType.BOOL,pretty_name:"Response ends trial",default:!0},pre_target_duration:{type:t.ParameterType.INT,pretty_name:"Pre-target duration",default:0},trial_duration:{type:t.ParameterType.INT,pretty_name:"Trial duration",default:null},fade_duration:{type:t.ParameterType.INT,pretty_name:"Fade duration",default:null},allow_nontarget_responses:{type:t.ParameterType.BOOL,pretty_name:"Allow nontarget response",default:!1},prompt:{type:t.ParameterType.HTML_STRING,pretty_name:"Prompt",default:null}}};class r{constructor(t){this.jsPsych=t}trial(t,e){function r(t){s=null==s.rt?t:s,e.response_ends_trial&&n()}var a=-1,s={rt:null,row:null,column:null};const i=()=>{var s;s=e.allow_nontarget_responses?t.querySelectorAll(".jspsych-serial-reaction-time-stimulus-cell"):[t.querySelector("#jspsych-serial-reaction-time-stimulus-cell-"+e.target[0]+"-"+e.target[1])];for(var i=0;i<s.length;i++)s[i].addEventListener("mousedown",t=>{if(-1!=a){var e={};e.row=t.currentTarget.getAttribute("data-row"),e.column=t.currentTarget.getAttribute("data-column"),e.rt=Math.round(performance.now()-a),r(e)}});a=performance.now(),null==e.fade_duration||(t.querySelector("#jspsych-serial-reaction-time-stimulus-cell-"+e.target[0]+"-"+e.target[1]).style.transition="background-color "+e.fade_duration),t.querySelector("#jspsych-serial-reaction-time-stimulus-cell-"+e.target[0]+"-"+e.target[1]).style.backgroundColor=e.target_color,null!==e.trial_duration&&this.jsPsych.pluginAPI.setTimeout(n,e.trial_duration)};var l=this.stimulus(e.grid,e.grid_square_size);t.innerHTML=l,e.pre_target_duration<=0?i():this.jsPsych.pluginAPI.setTimeout(i,e.pre_target_duration),null!==e.prompt&&t.insertAdjacentHTML("beforeend",e.prompt);const n=()=>{this.jsPsych.pluginAPI.clearAllTimeouts();var r={rt:s.rt,grid:e.grid,target:e.target,response:[parseInt(s.row,10),parseInt(s.column,10)],correct:s.row==e.target[0]&&s.column==e.target[1]};t.innerHTML="",this.jsPsych.finishTrial(r)}}stimulus(t,e,r,a,s){for(var i="<div id='jspsych-serial-reaction-time-stimulus' style='margin:auto; display: table; table-layout: fixed; border-spacing:"+e/4+"px'>",l=0;l<t.length;l++){i+="<div class='jspsych-serial-reaction-time-stimulus-row' style='display:table-row;'>";for(var n=0;n<t[l].length;n++){i+="<div class='"+"jspsych-serial-reaction-time-stimulus-cell"+"' id='jspsych-serial-reaction-time-stimulus-cell-"+l+"-"+n+"' data-row="+l+" data-column="+n+" style='width:"+e+"px; height:"+e+"px; display:table-cell; vertical-align:middle; text-align: center; cursor: pointer; font-size:"+e/2+"px;",1==t[l][n]&&(i+="border: 2px solid black;"),void 0!==r&&r[0]==l&&r[1]==n&&(i+="background-color: "+a+";"),i+="'>",void 0!==s&&!1!==s[l][n]&&(i+=s[l][n]),i+="</div>"}i+="</div>"}return i+="</div>"}simulate(t,e,r,a){"data-only"==e&&(a(),this.simulate_data_only(t,r)),"visual"==e&&this.simulate_visual(t,r,a)}create_simulation_data(t,e){let r=this.jsPsych.utils.deepCopy(t.target);if(t.allow_nontarget_responses&&1!==this.jsPsych.randomization.sampleBernoulli(.8))for(;r[0]==t.target[0]&&r[1]==t.target[1];)r[0],this.jsPsych.randomization.randomInt(0,t.grid.length),r[1],this.jsPsych.randomization.randomInt(0,t.grid[r[0]].length);const a={grid:t.grid,target:t.target,response:r,rt:t.pre_target_duration+this.jsPsych.randomization.sampleExGaussian(500,50,1/150,!0),correct:r[0]==t.target[0]&&r[1]==t.target[1]},s=this.jsPsych.pluginAPI.mergeSimulationData(a,e);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(t,s),s}simulate_data_only(t,e){const r=this.create_simulation_data(t,e);this.jsPsych.finishTrial(r)}simulate_visual(t,e,r){const a=this.create_simulation_data(t,e),s=this.jsPsych.getDisplayElement();if(this.trial(s,t),r(),null!==a.rt){const t=s.querySelector(`.jspsych-serial-reaction-time-stimulus-cell[data-row="${a.response[0]}"][data-column="${a.response[1]}"]`);this.jsPsych.pluginAPI.clickTarget(t,a.rt)}}}return r.info=e,r}(jsPsychModule);