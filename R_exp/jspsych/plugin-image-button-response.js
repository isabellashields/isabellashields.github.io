var jsPsychImageButtonResponse=function(t){"use strict";const e={name:"image-button-response",parameters:{stimulus:{type:t.ParameterType.IMAGE,pretty_name:"Stimulus",default:void 0},stimulus_height:{type:t.ParameterType.INT,pretty_name:"Image height",default:null},stimulus_width:{type:t.ParameterType.INT,pretty_name:"Image width",default:null},maintain_aspect_ratio:{type:t.ParameterType.BOOL,pretty_name:"Maintain aspect ratio",default:!0},choices:{type:t.ParameterType.STRING,pretty_name:"Choices",default:void 0,array:!0},button_html:{type:t.ParameterType.HTML_STRING,pretty_name:"Button HTML",default:'<button class="jspsych-btn">%choice%</button>',array:!0},prompt:{type:t.ParameterType.HTML_STRING,pretty_name:"Prompt",default:null},stimulus_duration:{type:t.ParameterType.INT,pretty_name:"Stimulus duration",default:null},trial_duration:{type:t.ParameterType.INT,pretty_name:"Trial duration",default:null},margin_vertical:{type:t.ParameterType.STRING,pretty_name:"Margin vertical",default:"0px"},margin_horizontal:{type:t.ParameterType.STRING,pretty_name:"Margin horizontal",default:"8px"},response_ends_trial:{type:t.ParameterType.BOOL,pretty_name:"Response ends trial",default:!0},render_on_canvas:{type:t.ParameterType.BOOL,pretty_name:"Render on canvas",default:!0},enable_button_after:{type:t.ParameterType.INT,pretty_name:"Enable button after",default:0}}};class s{constructor(t){this.jsPsych=t}trial(t,e){function s(s){var i=performance.now(),a=Math.round(i-_);g.button=parseInt(s),g.rt=a,t.querySelector("#jspsych-image-button-response-stimulus").className+=" responded";for(var n=document.querySelectorAll(".jspsych-image-button-response-button button"),r=0;r<n.length;r++)n[r].setAttribute("disabled","disabled");e.response_ends_trial&&b()}function i(){for(var t=document.querySelectorAll(".jspsych-image-button-response-button button"),e=0;e<t.length;e++)t[e].removeAttribute("disabled")}function a(){for(var t=document.querySelectorAll(".jspsych-image-button-response-button button"),e=0;e<t.length;e++)t[e].setAttribute("disabled","disabled")}var n,r,l;if(e.render_on_canvas){var u=!1;if(t.hasChildNodes())for(;t.firstChild;)t.removeChild(t.firstChild);var o=document.createElement("canvas");o.id="jspsych-image-button-response-stimulus",o.style.margin="0",o.style.padding="0";var h=o.getContext("2d");(y=new Image).onload=()=>{u||(s(),h.drawImage(y,0,0,r,n))},y.src=e.stimulus;const s=()=>{null!==e.stimulus_height?(n=e.stimulus_height,null==e.stimulus_width&&e.maintain_aspect_ratio&&(r=y.naturalWidth*(e.stimulus_height/y.naturalHeight))):n=y.naturalHeight,null!==e.stimulus_width?(r=e.stimulus_width,null==e.stimulus_height&&e.maintain_aspect_ratio&&(n=y.naturalHeight*(e.stimulus_width/y.naturalWidth))):null!==e.stimulus_height&&e.maintain_aspect_ratio||(r=y.naturalWidth),o.height=n,o.width=r};s();var m=[];if(Array.isArray(e.button_html))e.button_html.length==e.choices.length&&(m=e.button_html);else for(var c=0;c<e.choices.length;c++)m.push(e.button_html);var p=document.createElement("div");p.id="jspsych-image-button-response-btngroup",l="";for(c=0;c<e.choices.length;c++){var d=m[c].replace(/%choice%/g,e.choices[c]);l+='<div class="jspsych-image-button-response-button" style="display: inline-block; margin:'+e.margin_vertical+" "+e.margin_horizontal+'" id="jspsych-image-button-response-button-'+c+'" data-choice="'+c+'">'+d+"</div>"}p.innerHTML=l,t.insertBefore(o,null),y.complete&&Number.isFinite(r)&&Number.isFinite(n)&&(h.drawImage(y,0,0,r,n),u=!0),t.insertBefore(p,o.nextElementSibling),null!==e.prompt&&t.insertAdjacentHTML("beforeend",e.prompt)}else{l='<img src="'+e.stimulus+'" id="jspsych-image-button-response-stimulus">';m=[];if(Array.isArray(e.button_html))e.button_html.length==e.choices.length&&(m=e.button_html);else for(c=0;c<e.choices.length;c++)m.push(e.button_html);l+='<div id="jspsych-image-button-response-btngroup">';for(c=0;c<e.choices.length;c++){d=m[c].replace(/%choice%/g,e.choices[c]);l+='<div class="jspsych-image-button-response-button" style="display: inline-block; margin:'+e.margin_vertical+" "+e.margin_horizontal+'" id="jspsych-image-button-response-button-'+c+'" data-choice="'+c+'">'+d+"</div>"}l+="</div>",null!==e.prompt&&(l+=e.prompt),t.innerHTML=l;var y=t.querySelector("#jspsych-image-button-response-stimulus");null!==e.stimulus_height?(n=e.stimulus_height,null==e.stimulus_width&&e.maintain_aspect_ratio&&(r=y.naturalWidth*(e.stimulus_height/y.naturalHeight))):n=y.naturalHeight,null!==e.stimulus_width?(r=e.stimulus_width,null==e.stimulus_height&&e.maintain_aspect_ratio&&(n=y.naturalHeight*(e.stimulus_width/y.naturalWidth))):null!==e.stimulus_height&&e.maintain_aspect_ratio||(r=y.naturalWidth),y.style.height=n.toString()+"px",y.style.width=r.toString()+"px"}var _=performance.now();for(c=0;c<e.choices.length;c++)t.querySelector("#jspsych-image-button-response-button-"+c).addEventListener("click",t=>{s(t.currentTarget.getAttribute("data-choice"))});var g={rt:null,button:null};const b=()=>{this.jsPsych.pluginAPI.clearAllTimeouts();var s={rt:g.rt,stimulus:e.stimulus,response:g.button};t.innerHTML="",this.jsPsych.finishTrial(s)};e.enable_button_after>0&&(a(),this.jsPsych.pluginAPI.setTimeout(()=>{i()},e.enable_button_after)),null!==e.stimulus_duration&&this.jsPsych.pluginAPI.setTimeout(()=>{t.querySelector("#jspsych-image-button-response-stimulus").style.visibility="hidden"},e.stimulus_duration),null!==e.trial_duration?this.jsPsych.pluginAPI.setTimeout(()=>{b()},e.trial_duration):e.response_ends_trial}simulate(t,e,s,i){"data-only"==e&&(i(),this.simulate_data_only(t,s)),"visual"==e&&this.simulate_visual(t,s,i)}create_simulation_data(t,e){const s={stimulus:t.stimulus,rt:this.jsPsych.randomization.sampleExGaussian(500,50,1/150,!0)+t.enable_button_after,response:this.jsPsych.randomization.randomInt(0,t.choices.length-1)},i=this.jsPsych.pluginAPI.mergeSimulationData(s,e);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(t,i),i}simulate_data_only(t,e){const s=this.create_simulation_data(t,e);this.jsPsych.finishTrial(s)}simulate_visual(t,e,s){const i=this.create_simulation_data(t,e),a=this.jsPsych.getDisplayElement();this.trial(a,t),s(),null!==i.rt&&this.jsPsych.pluginAPI.clickTarget(a.querySelector(`div[data-choice="${i.response}"] button`),i.rt)}}return s.info=e,s}(jsPsychModule);