var jsPsychVideoButtonResponse=function(e){"use strict";const t={name:"video-button-response",parameters:{stimulus:{type:e.ParameterType.VIDEO,pretty_name:"Video",default:void 0,array:!0},choices:{type:e.ParameterType.STRING,pretty_name:"Choices",default:void 0,array:!0},button_html:{type:e.ParameterType.HTML_STRING,pretty_name:"Button HTML",default:'<button class="jspsych-btn">%choice%</button>',array:!0},prompt:{type:e.ParameterType.HTML_STRING,pretty_name:"Prompt",default:null},width:{type:e.ParameterType.INT,pretty_name:"Width",default:""},height:{type:e.ParameterType.INT,pretty_name:"Height",default:""},autoplay:{type:e.ParameterType.BOOL,pretty_name:"Autoplay",default:!0},controls:{type:e.ParameterType.BOOL,pretty_name:"Controls",default:!1},start:{type:e.ParameterType.FLOAT,pretty_name:"Start",default:null},stop:{type:e.ParameterType.FLOAT,pretty_name:"Stop",default:null},rate:{type:e.ParameterType.FLOAT,pretty_name:"Rate",default:1},trial_ends_after_video:{type:e.ParameterType.BOOL,pretty_name:"End trial after video finishes",default:!1},trial_duration:{type:e.ParameterType.INT,pretty_name:"Trial duration",default:null},margin_vertical:{type:e.ParameterType.STRING,pretty_name:"Margin vertical",default:"0px"},margin_horizontal:{type:e.ParameterType.STRING,pretty_name:"Margin horizontal",default:"8px"},response_ends_trial:{type:e.ParameterType.BOOL,pretty_name:"Response ends trial",default:!0},response_allowed_while_playing:{type:e.ParameterType.BOOL,pretty_name:"Response allowed while playing",default:!0},enable_button_after:{type:e.ParameterType.INT,pretty_name:"Enable button after",default:0}}};class a{constructor(e){this.jsPsych=e}trial(e,t){function a(e){var a=performance.now(),s=Math.round(a-c);v.button=parseInt(e),v.rt=s,h.className+=" responded",r(),t.response_ends_trial&&b()}function s(e){a(e.currentTarget.getAttribute("data-choice"))}function r(){for(var e=document.querySelectorAll(".jspsych-video-button-response-button"),t=0;t<e.length;t++){var a=e[t].querySelector("button");a&&(a.disabled=!0),e[t].removeEventListener("click",s)}}function n(){for(var e=document.querySelectorAll(".jspsych-video-button-response-button"),t=0;t<e.length;t++){var a=e[t].querySelector("button");a&&(a.disabled=!1),e[t].addEventListener("click",s)}}if(!Array.isArray(t.stimulus))throw new Error("\n        The stimulus property for the video-button-response plugin must be an array\n        of files. See https://www.jspsych.org/latest/plugins/video-button-response/#parameters\n      ");var i="<div>";i+='<video id="jspsych-video-button-response-stimulus"',t.width&&(i+=' width="'+t.width+'"'),t.height&&(i+=' height="'+t.height+'"'),t.autoplay&&null==t.start&&(i+=" autoplay "),t.controls&&(i+=" controls "),null!==t.start&&(i+=' style="visibility: hidden;"'),i+=">";var o=this.jsPsych.pluginAPI.getVideoBuffer(t.stimulus[0]);if(!o)for(var l=0;l<t.stimulus.length;l++){var u=t.stimulus[l];u.indexOf("?")>-1&&(u=u.substring(0,u.indexOf("?")));var p=u.substr(u.lastIndexOf(".")+1);i+='<source src="'+u+'" type="video/'+(p=p.toLowerCase())+'">'}i+="</video>",i+="</div>";var y=[];if(Array.isArray(t.button_html))t.button_html.length==t.choices.length&&(y=t.button_html);else for(l=0;l<t.choices.length;l++)y.push(t.button_html);i+='<div id="jspsych-video-button-response-btngroup">';for(l=0;l<t.choices.length;l++){var d=y[l].replace(/%choice%/g,t.choices[l]);i+='<div class="jspsych-video-button-response-button" style="cursor: pointer; display: inline-block; margin:'+t.margin_vertical+" "+t.margin_horizontal+'" id="jspsych-video-button-response-button-'+l+'" data-choice="'+l+'">'+d+"</div>"}i+="</div>",null!==t.prompt&&(i+=t.prompt),e.innerHTML=i;var c=performance.now(),h=e.querySelector("#jspsych-video-button-response-stimulus");o&&(h.src=o),h.onended=()=>{t.trial_ends_after_video?b():t.response_allowed_while_playing||n()},h.playbackRate=t.rate,null!==t.start&&(h.pause(),h.onseeked=()=>{h.style.visibility="visible",h.muted=!1,t.autoplay?h.play():h.pause(),h.onseeked=()=>{}},h.onplaying=()=>{h.currentTime=t.start,h.onplaying=()=>{}},h.muted=!0,h.play());let m=!1;null!==t.stop&&h.addEventListener("timeupdate",()=>{h.currentTime>=t.stop&&(t.response_allowed_while_playing||(t.enable_button_after>0?_(t.enable_button_after):n()),h.pause(),t.trial_ends_after_video&&!m&&(m=!0,b()))});const _=e=>{this.jsPsych.pluginAPI.setTimeout(n,e)};t.response_allowed_while_playing?(r(),null!==t.enable_button_after?_(t.enable_button_after):n()):r();var v={rt:null,button:null};const b=()=>{this.jsPsych.pluginAPI.clearAllTimeouts(),e.querySelector("#jspsych-video-button-response-stimulus").pause(),e.querySelector("#jspsych-video-button-response-stimulus").onended=()=>{};var a={rt:v.rt,stimulus:t.stimulus,response:v.button};e.innerHTML="",this.jsPsych.finishTrial(a)};null!==t.trial_duration&&this.jsPsych.pluginAPI.setTimeout(b,t.trial_duration)}simulate(e,t,a,s){"data-only"==t&&(s(),this.simulate_data_only(e,a)),"visual"==t&&this.simulate_visual(e,a,s)}create_simulation_data(e,t){const a={stimulus:e.stimulus,rt:this.jsPsych.randomization.sampleExGaussian(500,50,1/150,!0)+e.enable_button_after,response:this.jsPsych.randomization.randomInt(0,e.choices.length-1)},s=this.jsPsych.pluginAPI.mergeSimulationData(a,t);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(e,s),s}simulate_data_only(e,t){const a=this.create_simulation_data(e,t);this.jsPsych.finishTrial(a)}simulate_visual(e,t,a){const s=this.create_simulation_data(e,t),r=this.jsPsych.getDisplayElement();this.trial(r,e),a();const n=r.querySelector("#jspsych-video-button-response-stimulus"),i=()=>{null!==s.rt&&this.jsPsych.pluginAPI.clickTarget(r.querySelector(`div[data-choice="${s.response}"] button`),s.rt)};e.response_allowed_while_playing?i():n.addEventListener("ended",i)}}return a.info=t,a}(jsPsychModule);