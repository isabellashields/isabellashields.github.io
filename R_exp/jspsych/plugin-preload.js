var jsPsychPreload=function(e){"use strict";const r={name:"preload",parameters:{auto_preload:{type:e.ParameterType.BOOL,pretty_name:"Auto-preload",default:!1},trials:{type:e.ParameterType.TIMELINE,pretty_name:"Trials",default:[]},images:{type:e.ParameterType.STRING,pretty_name:"Images",default:[],array:!0},audio:{type:e.ParameterType.STRING,pretty_name:"Audio",default:[],array:!0},video:{type:e.ParameterType.STRING,pretty_name:"Video",default:[],array:!0},message:{type:e.ParameterType.HTML_STRING,pretty_name:"Message",default:null},show_progress_bar:{type:e.ParameterType.BOOL,pretty_name:"Show progress bar",default:!0},continue_after_error:{type:e.ParameterType.BOOL,pretty_name:"Continue after error",default:!1},error_message:{type:e.ParameterType.HTML_STRING,pretty_name:"Error message",default:"The experiment failed to load."},show_detailed_errors:{type:e.ParameterType.BOOL,pretty_name:"Show detailed errors",default:!1},max_load_time:{type:e.ParameterType.INT,pretty_name:"Max load time",default:null},on_error:{type:e.ParameterType.FUNCTION,pretty_name:"On error",default:null},on_success:{type:e.ParameterType.FUNCTION,pretty_name:"On success",default:null}}};class t{constructor(e){this.jsPsych=e}trial(e,r){function t(e){T(),null==o&&(o=!1);var t="unknown file";e.source&&(t=e.source),e.error&&e.error.path&&e.error.path.length>0&&("img"==e.error.path[0].localName?n.push(t):"audio"==e.error.path[0].localName?u.push(t):"video"==e.error.path[0].localName&&d.push(t));var a="<p><strong>Error loading file: "+t+"</strong><br>";e.error.statusText&&(a+="File request response status: "+e.error.statusText+"<br>"),"404"==e.error&&(a+="404 - file not found.<br>"),void 0!==e.error.loaded&&null!==e.error.loaded&&0!==e.error.loaded?a+=e.error.loaded+" bytes transferred.":a+="File did not begin loading. Check that file path is correct and reachable by the browser,<br>and that loading is not blocked by cross-origin resource sharing (CORS) errors.",a+="</p>",c.push(a),s(t),L==A&&(r.continue_after_error?b():I())}function a(e){T(),i(e),++N==A?j():L==A&&(r.continue_after_error?b():I())}function s(e){null!==r.on_error&&r.on_error(e)}function i(e){null!==r.on_success&&r.on_success(e)}var o=null,l=!1,n=[],u=[],d=[],c=[],h=this.jsPsych.getSafeModeStatus(),p=[],y=[],m=[];if(r.auto_preload){var g=this.jsPsych.getTimeline(),_=this.jsPsych.pluginAPI.getAutoPreloadList(g);p=p.concat(_.images),y=y.concat(_.audio),m=m.concat(_.video)}if(r.trials.length>0){var P=this.jsPsych.pluginAPI.getAutoPreloadList(r.trials);p=p.concat(P.images),y=y.concat(P.audio),m=m.concat(P.video)}p=p.concat(r.images),y=y.concat(r.audio),m=m.concat(r.video),p=this.jsPsych.utils.unique(p.flat()),y=this.jsPsych.utils.unique(y.flat()),m=this.jsPsych.utils.unique(m.flat()),h&&(m=[]);var f="";null!==r.message&&(f+=r.message),r.show_progress_bar&&(f+="\n            <div id='jspsych-loading-progress-bar-container' style='height: 10px; width: 300px; background-color: #ddd; margin: auto;'>\n              <div id='jspsych-loading-progress-bar' style='height: 10px; width: 0%; background-color: #777;'></div>\n            </div>"),e.innerHTML=f;const T=()=>{if(L++,r.show_progress_bar){var t=L/A*100,a=e.querySelector("#jspsych-loading-progress-bar");null!==a&&(a.style.width=t+"%")}},j=()=>{void 0!==l&&!1===l&&(this.jsPsych.pluginAPI.clearAllTimeouts(),this.jsPsych.pluginAPI.cancelPreloads(),o=!0,b())},v=()=>{this.jsPsych.pluginAPI.cancelPreloads(),void 0===o||!1!==o&&null!==o||(l=!0,N<A&&(o=!1),s("timeout"),c.push("<p><strong>Loading timed out.</strong><br>Consider compressing your stimuli files, loading your files in smaller batches,<br>and/or increasing the <i>max_load_time</i> parameter.</p>"),r.continue_after_error?b():I())},I=()=>{this.jsPsych.pluginAPI.clearAllTimeouts(),this.jsPsych.pluginAPI.cancelPreloads(),e.innerHTML=r.error_message,r.show_detailed_errors&&(e.innerHTML+="<p><strong>Error details:</strong></p>",c.forEach(r=>{e.innerHTML+=r}))},b=()=>{this.jsPsych.pluginAPI.clearAllTimeouts();var r={success:o,timeout:l,failed_images:n,failed_audio:u,failed_video:d};e.innerHTML="",this.jsPsych.finishTrial(r)};null!==r.max_load_time&&this.jsPsych.pluginAPI.setTimeout(v,r.max_load_time);var A=p.length+y.length+m.length,L=0,N=0;if(0==A)j();else{const e=e=>{this.jsPsych.pluginAPI.preloadVideo(m,e,a,t)},r=e=>{this.jsPsych.pluginAPI.preloadAudio(y,e,a,t)},s=e=>{this.jsPsych.pluginAPI.preloadImages(p,e,a,t)};m.length>0&&e(()=>{}),y.length>0&&r(()=>{}),p.length>0&&s(()=>{})}}simulate(e,r,t,a){"data-only"==r&&(a(),this.simulate_data_only(e,t)),"visual"==r&&this.simulate_visual(e,t,a)}create_simulation_data(e,r){const t={success:!0,timeout:!1,failed_images:[],failed_audio:[],failed_video:[]};return this.jsPsych.pluginAPI.mergeSimulationData(t,r)}simulate_data_only(e,r){const t=this.create_simulation_data(e,r);this.jsPsych.finishTrial(t)}simulate_visual(e,r,t){const a=this.jsPsych.getDisplayElement();this.trial(a,e),t()}}return t.info=r,t}(jsPsychModule);