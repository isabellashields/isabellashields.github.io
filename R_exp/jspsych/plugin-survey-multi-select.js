var jsPsychSurveyMultiSelect=function(e){"use strict";const t={name:"survey-multi-select",parameters:{questions:{type:e.ParameterType.COMPLEX,array:!0,pretty_name:"Questions",nested:{prompt:{type:e.ParameterType.HTML_STRING,pretty_name:"Prompt",default:void 0},options:{type:e.ParameterType.STRING,pretty_name:"Options",array:!0,default:void 0},horizontal:{type:e.ParameterType.BOOL,pretty_name:"Horizontal",default:!1},required:{type:e.ParameterType.BOOL,pretty_name:"Required",default:!1},name:{type:e.ParameterType.STRING,pretty_name:"Question Name",default:""}}},randomize_question_order:{type:e.ParameterType.BOOL,pretty_name:"Randomize Question Order",default:!1},preamble:{type:e.ParameterType.HTML_STRING,pretty_name:"Preamble",default:null},button_label:{type:e.ParameterType.STRING,pretty_name:"Button label",default:"Continue"},required_message:{type:e.ParameterType.STRING,pretty_name:"Required message",default:"You must choose at least one response for this question"},autocomplete:{type:e.ParameterType.BOOL,pretty_name:"Allow autocomplete",default:!1}}};class s{constructor(e){this.jsPsych=e}trial(e,t){var s="jspsych-survey-multi-select",r="#"+s;const i=(...e)=>e.join("-");var n=".jspsych-survey-multi-select-question { margin-top: 2em; margin-bottom: 2em; text-align: left; }.jspsych-survey-multi-select-text span.required {color: darkred;}.jspsych-survey-multi-select-horizontal .jspsych-survey-multi-select-text {  text-align: center;}.jspsych-survey-multi-select-option { line-height: 2; }.jspsych-survey-multi-select-horizontal .jspsych-survey-multi-select-option {  display: inline-block;  margin-left: 1em;  margin-right: 1em;  vertical-align: top;}label.jspsych-survey-multi-select-text input[type='checkbox'] {margin-right: 1em;}";e.innerHTML='<style id="jspsych-survey-multi-select-css">'+n+"</style>";var a=i(s,"form");e.innerHTML+='<form id="'+a+'"></form>';var o=e.querySelector("#"+a);t.autocomplete||o.setAttribute("autocomplete","off");var l=i(s,"preamble");null!==t.preamble&&(o.innerHTML+='<div id="'+l+'" class="'+l+'">'+t.preamble+"</div>");for(var u=[],c=0;c<t.questions.length;c++)u.push(c);t.randomize_question_order&&(u=this.jsPsych.randomization.shuffle(u));for(c=0;c<t.questions.length;c++){var m=t.questions[u[c]],y=u[c],p=[i(s,"question")];m.horizontal&&p.push(i(s,"horizontal")),o.innerHTML+='<div id="'+i(s,y)+'" data-name="'+m.name+'" class="'+p.join(" ")+'"></div>';var h=i(r,y);e.querySelector(h).innerHTML+='<p id="survey-question" class="'+s+'-text survey-multi-select">'+m.prompt+"</p>";for(var d=0;d<m.options.length;d++){var v=i(s,"option",y,d);e.querySelector(h).innerHTML+='<div id="'+v+'" class="'+i(s,"option")+'"></div>';var f=document.getElementById(v),q=i(s,"response",y),g=i(s,"response",y,d),j=document.createElement("label");j.setAttribute("class",s+"-text"),j.innerHTML=m.options[d],j.setAttribute("for",g);var _=document.createElement("input");_.setAttribute("type","checkbox"),_.setAttribute("name",q),_.setAttribute("id",g),_.setAttribute("value",m.options[d]),f.appendChild(j),j.insertBefore(_,j.firstChild)}}o.innerHTML+='<div class="fail-message"></div>',o.innerHTML+='<button id="'+s+'-next" class="'+s+' jspsych-btn">'+t.button_label+"</button>",e.querySelector("#jspsych-survey-multi-select-next").addEventListener("click",()=>{for(var s=0;s<t.questions.length;s++)t.questions[s].required&&(null==e.querySelector("#jspsych-survey-multi-select-"+s+" input:checked")?e.querySelector("#jspsych-survey-multi-select-"+s+" input").setCustomValidity(t.required_message):e.querySelector("#jspsych-survey-multi-select-"+s+" input").setCustomValidity(""));o.reportValidity()}),o.addEventListener("submit",s=>{s.preventDefault();for(var r=performance.now(),i=Math.round(r-P),n={},a=0;a<t.questions.length;a++){for(var o=e.querySelector("#jspsych-survey-multi-select-"+a),l=[],c=o.querySelectorAll("input[type=checkbox]:checked"),m=0;m<c.length;m++){var y=c[m];l.push(y.value)}var p={},h="Q"+a;""!==o.attributes["data-name"].value&&(h=o.attributes["data-name"].value),p[h]=l,Object.assign(n,p),l.length}var d={rt:i,response:n,question_order:u};e.innerHTML="",this.jsPsych.finishTrial(d)});var P=performance.now()}simulate(e,t,s,r){"data-only"==t&&(r(),this.simulate_data_only(e,s)),"visual"==t&&this.simulate_visual(e,s,r)}create_simulation_data(e,t){const s={};let r=1e3;for(const t of e.questions){let i;i=t.required?this.jsPsych.randomization.randomInt(1,t.options.length):this.jsPsych.randomization.randomInt(0,t.options.length);const n=t.name?t.name:`Q${e.questions.indexOf(t)}`,a=this.jsPsych.randomization.sampleWithoutReplacement(t.options,i);s[n]=a,r+=this.jsPsych.randomization.sampleExGaussian(1500,400,.005,!0)}const i={response:s,rt:r,question_order:e.randomize_question_order?this.jsPsych.randomization.shuffle([...Array(e.questions.length).keys()]):[...Array(e.questions.length).keys()]},n=this.jsPsych.pluginAPI.mergeSimulationData(i,t);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(e,n),n}simulate_data_only(e,t){const s=this.create_simulation_data(e,t);this.jsPsych.finishTrial(s)}simulate_visual(e,t,s){const r=this.create_simulation_data(e,t),i=this.jsPsych.getDisplayElement();this.trial(i,e),s();const n=Object.entries(r.response);for(let t=0;t<n.length;t++)for(const s of n[t][1])this.jsPsych.pluginAPI.clickTarget(i.querySelector(`#jspsych-survey-multi-select-response-${t}-${e.questions[t].options.indexOf(s)}`),(r.rt-1e3)/n.length*(t+1));this.jsPsych.pluginAPI.clickTarget(i.querySelector("#jspsych-survey-multi-select-next"),r.rt)}}return s.info=t,s}(jsPsychModule);